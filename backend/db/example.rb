# reference: [Gyroscope Fun with NeoPixel Ring](https://create.arduino.cc/projecthub/danionescu/gyroscope-fun-with-neopixel-ring-3a0b84)

descriptions = [

  {
    title: '',
    desc: %{

    },
  },

]

#https://hackster.imgix.net/uploads/attachments/393480/main_rOhiO74qPh.png?auto=compress%2Cformat&w=400&h=300&fit=min
#https://hackster.imgix.net/uploads/attachments/393480/main_rOhiO74qPh.png?auto=compress%2Cformat&amp;w=900&amp;h=675&

%{

<div class="section-content">

+-------------+-------------+-------------+-------------+-------------+
| [![11113    |   --------- | [×](/projec | [1](/projec | [**](/proje |
| 01](https:/ | ----------- | thub/produc | thub/produc | cthub/produ |
| /hackster.i | ----------- | ts/buy/64?s | ts/buy/64?s | cts/buy/64? |
| mgix.net/up | ----------- | =BAhJIhY2NT | =BAhJIhY2NT | s=BAhJIhY2N |
| loads/image | ----------- | M1NSxCYXNlQ | M1NSxCYXNlQ | TM1NSxCYXNl |
| /file/49071 | ----------- | XJ0aWNsZQY6 | XJ0aWNsZQY6 | QXJ0aWNsZQY |
| /11113-01.j | ----------- | BkVG%0A)    | BkVG%0A)    | 6BkVG%0A)   |
| pg?auto=com | ----------- |             |             |             |
| press%2Cfor | ----------- |             |             |             |
| mat&w=140&h | ----------- |             |             |             |
| =140&fit=fi | -------     |             |             |             |
| ll&bg=fffff |   [SparkFun |             |             |             |
| f)](/projec |  Arduino Pr |             |             |             |
| thub/produc | o Mini 328  |             |             |             |
| ts/buy/64?s | - 5V/16MHz] |             |             |             |
| =BAhJIhY2NT | (/projecthu |             |             |             |
| M1NSxCYXNlQ | b/products/ |             |             |             |
| XJ0aWNsZQY6 | buy/64?s=BA |             |             |             |
| BkVG%0A)    | hJIhY2NTM1N |             |             |             |
|             | SxCYXNlQXJ0 |             |             |             |
|             | aWNsZQY6BkV |             |             |             |
|             | G%0A)       |             |             |             |
|             |   --------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | -------     |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| [![1586     |   --------- | [×](/projec | [1](/projec | [**](/proje |
| 00](https:/ | ----------- | thub/produc | thub/produc | cthub/produ |
| /hackster.i | ----------- | ts/buy/1734 | ts/buy/1734 | cts/buy/173 |
| mgix.net/up | ----------- | 4?s=BAhJIhY | 4?s=BAhJIhY | 44?s=BAhJIh |
| loads/image | ----------- | 2NTM1NSxCYX | 2NTM1NSxCYX | Y2NTM1NSxCY |
| /file/96146 | ----------- | NlQXJ0aWNsZ | NlQXJ0aWNsZ | XNlQXJ0aWNs |
| /1586-00.jp | ----------- | QY6BkVG%0A) | QY6BkVG%0A) | ZQY6BkVG%0A |
| g?auto=comp | ----------- |             |             | )           |
| ress%2Cform | ----------- |             |             |             |
| at&w=140&h= | ----------- |             |             |             |
| 140&fit=fil | ----------- |             |             |             |
| l&bg=ffffff | --          |             |             |             |
| )](/project |   [Adafruit |             |             |             |
| hub/product |  NeoPixel R |             |             |             |
| s/buy/17344 | ing: WS2812 |             |             |             |
| ?s=BAhJIhY2 |  5050 RGB L |             |             |             |
| NTM1NSxCYXN | ED](/projec |             |             |             |
| lQXJ0aWNsZQ | thub/produc |             |             |             |
| Y6BkVG%0A)  | ts/buy/1734 |             |             |             |
|             | 4?s=BAhJIhY |             |             |             |
|             | 2NTM1NSxCYX |             |             |             |
|             | NlQXJ0aWNsZ |             |             |             |
|             | QY6BkVG%0A) |             |             |             |
|             |   --------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | --          |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| [![13762    |   --------- | [×](/projec | [1](/projec | [**](/proje |
| 00](https:/ | ----------- | thub/produc | thub/produc | cthub/produ |
| /hackster.i | ----------- | ts/buy/857? | ts/buy/857? | cts/buy/857 |
| mgix.net/up | ----------- | s=BAhJIhY2N | s=BAhJIhY2N | ?s=BAhJIhY2 |
| loads/attac | ----------- | TM1NSxCYXNl | TM1NSxCYXNl | NTM1NSxCYXN |
| hments/1759 | ----------- | QXJ0aWNsZQY | QXJ0aWNsZQY | lQXJ0aWNsZQ |
| 53/13762-00 | ----------- | 6BkVG%0A)   | 6BkVG%0A)   | Y6BkVG%0A)  |
| .jpg?auto=c | ----------- |             |             |             |
| ompress%2Cf | ----------- |             |             |             |
| ormat&w=140 | ----------- |             |             |             |
| &h=140&fit= |   [SparkFun |             |             |             |
| fill&bg=fff |  IMU Breako |             |             |             |
| fff)](/proj | ut - MPU-92 |             |             |             |
| ecthub/prod | 50](/projec |             |             |             |
| ucts/buy/85 | thub/produc |             |             |             |
| 7?s=BAhJIhY | ts/buy/857? |             |             |             |
| 2NTM1NSxCYX | s=BAhJIhY2N |             |             |             |
| NlQXJ0aWNsZ | TM1NSxCYXNl |             |             |             |
| QY6BkVG%0A) | QXJ0aWNsZQY |             |             |             |
|             | 6BkVG%0A)   |             |             |             |
|             |   --------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| [![12002    |   --------- | [×](/projec | [1](/projec | [**](/proje |
| 04](https:/ | ----------- | thub/produc | thub/produc | cthub/produ |
| /hackster.i | ----------- | ts/buy/42?s | ts/buy/42?s | cts/buy/42? |
| mgix.net/up | ----------- | =BAhJIhY2NT | =BAhJIhY2NT | s=BAhJIhY2N |
| loads/image | ----------- | M1NSxCYXNlQ | M1NSxCYXNlQ | TM1NSxCYXNl |
| /file/44494 | ----------- | XJ0aWNsZQY6 | XJ0aWNsZQY6 | QXJ0aWNsZQY |
| /12002-04.j | ----------- | BkVG%0A)    | BkVG%0A)    | 6BkVG%0A)   |
| pg?auto=com | ----------- |             |             |             |
| press%2Cfor | ---------   |             |             |             |
| mat&w=140&h |   [Breadboa |             |             |             |
| =140&fit=fi | rd (generic |             |             |             |
| ll&bg=fffff | )](/project |             |             |             |
| f)](/projec | hub/product |             |             |             |
| thub/produc | s/buy/42?s= |             |             |             |
| ts/buy/42?s | BAhJIhY2NTM |             |             |             |
| =BAhJIhY2NT | 1NSxCYXNlQX |             |             |             |
| M1NSxCYXNlQ | J0aWNsZQY6B |             |             |             |
| XJ0aWNsZQY6 | kVG%0A)     |             |             |             |
| BkVG%0A)    |   --------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ---------   |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |   --------- | [×](/projec | [1](/projec | [**](/proje |
|             | ----------- | thub/produc | thub/produc | cthub/produ |
|             | ----------- | ts/buy/416? | ts/buy/416? | cts/buy/416 |
|             | ----------- | s=BAhJIhY2N | s=BAhJIhY2N | ?s=BAhJIhY2 |
|             | ----------- | TM1NSxCYXNl | TM1NSxCYXNl | NTM1NSxCYXN |
|             | ----------- | QXJ0aWNsZQY | QXJ0aWNsZQY | lQXJ0aWNsZQ |
|             | ----------- | 6BkVG%0A)   | 6BkVG%0A)   | Y6BkVG%0A)  |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | -           |             |             |             |
|             |   [Male/Mal |             |             |             |
|             | e Jumper Wi |             |             |             |
|             | res](/proje |             |             |             |
|             | cthub/produ |             |             |             |
|             | cts/buy/416 |             |             |             |
|             | ?s=BAhJIhY2 |             |             |             |
|             | NTM1NSxCYXN |             |             |             |
|             | lQXJ0aWNsZQ |             |             |             |
|             | Y6BkVG%0A)  |             |             |             |
|             |   --------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | -           |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
| [![826      |   --------- | [×](/projec | [1](/projec | [**](/proje |
| 04](https:/ | ----------- | thub/produc | thub/produc | cthub/produ |
| /hackster.i | ----------- | ts/buy/417? | ts/buy/417? | cts/buy/417 |
| mgix.net/up | ----------- | s=BAhJIhY2N | s=BAhJIhY2N | ?s=BAhJIhY2 |
| loads/image | ----------- | TM1NSxCYXNl | TM1NSxCYXNl | NTM1NSxCYXN |
| /file/96107 | ----------- | QXJ0aWNsZQY | QXJ0aWNsZQY | lQXJ0aWNsZQ |
| /826-04.jpg | ----------- | 6BkVG%0A)   | 6BkVG%0A)   | Y6BkVG%0A)  |
| ?auto=compr | ----------- |             |             |             |
| ess%2Cforma | ----------- |             |             |             |
| t&w=140&h=1 | ---         |             |             |             |
| 40&fit=fill |   [Male/Fem |             |             |             |
| &bg=ffffff) | ale Jumper  |             |             |             |
| ](/projecth | Wires](/pro |             |             |             |
| ub/products | jecthub/pro |             |             |             |
| /buy/417?s= | ducts/buy/4 |             |             |             |
| BAhJIhY2NTM | 17?s=BAhJIh |             |             |             |
| 1NSxCYXNlQX | Y2NTM1NSxCY |             |             |             |
| J0aWNsZQY6B | XNlQXJ0aWNs |             |             |             |
| kVG%0A)     | ZQY6BkVG%0A |             |             |             |
|             | )           |             |             |             |
|             |   --------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ---         |             |             |             |
+-------------+-------------+-------------+-------------+-------------+
|             |   --------- | ×           | 1           |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ---         |             |             |             |
|             |   [4 AA bat |             |             |             |
|             | tery holder |             |             |             |
|             |  + battery] |             |             |             |
|             | {.component |             |             |             |
|             | }           |             |             |             |
|             |   --------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ----------- |             |             |             |
|             | ---         |             |             |             |
+-------------+-------------+-------------+-------------+-------------+

https://www.youtube.com/embed/MFQ2PecTw8g

[In this tutorial, we'll use the ]{}**MPU6050**[ gyroscope, a
]{}**NeoPixel**[ Ring and an ]{}**Arduino**[ to build a device that
lights LEDs corresponding to the angle of inclination.]{}

This is a simple and fun project and it's going to be assembled on a
breadboard. If you'll follow the steps you'll build what you saw in the
video. It's a good tutorial for learning about gyroscope and the
NeoPixel Ring.

I'm building this tutorial because of the interest i saw on some other
tutorial of min. In this tutorial i've replaced simple led's with a
NeoPixel Ring. The ring it's simpler to use through an Adafruit library
and it's definitely more spectacular.

So if you have these components lying around this is a great way to make
use of them, i'll try to take you step by step through building the
device and also explain how it works in the last step.

### [**](#toc-step-1--things-required-0){.title-anchor}[Step 1: Things Required]{} {#toc-step-1--things-required-0}

<figure>
[![](https://hackster.imgix.net/uploads/attachments/393483/2017-12-10_16_29_40_SYvpi0cUi5.jpg?auto=compress%2Cformat&w=680&h=510&fit=max)](javascript:openLightBox('b75d93ae92',%200);){.embed-img}
</figure>

<script>if (typeof(lightBoxImages) == 'undefined') {
  lightBoxImages = {};
}
lightBoxImages['b75d93ae92'] = [{
          URL: 'https://hackster.imgix.net/uploads/attachments/393483/2017-12-10_16_29_40_SYvpi0cUi5.jpg?auto=compress%2Cformat&w=1280&h=960&fit=max',
          caption: '',
          type: 'image'
      }];</script>
**Parts**

1\. Arduino Pro Mini 328P

2\. Breadboard

3\. MPU6050 gyroscope

4\. 24 NeoPixel LED Ring

5\. 4 x AA battery pack with 4 batteries

6\. U-shape jumper cables (optional). I've used these jumper cables
because they look better on the breadboard, and the leds are more
visible this way. You can find a box of 140 on ebay at about 4\$. If you
don't have these cables you can replace them with dupont wires.

**Tools:**

1\. USB to serial FTDI adapter FT232RL to programm the arduino pro mini

2\. Arduino IDE

**Skills:**[ ]{}

1\. Soldering

3\. Basic arduino programming

### [**](#toc-step-2--assembly-1){.title-anchor}[Step 2: Assembly]{} {#toc-step-2--assembly-1}

https://hackster.imgix.net/uploads/attachments/393484/sketch_bb_sZWFCbWVne.png?auto=compress%2Cformat&w=680&h=510&fit=max


<div class="image">
          URL: 'https://hackster.imgix.net/uploads/attachments/393484/sketch_bb_sZWFCbWVne.png?auto=compress%2Cformat&w=1280&h=960&fit=max',
          URL: 'https://hackster.imgix.net/uploads/attachments/393485/2017-12-10_16_46_39_pEycnPUFBx.jpg?auto=compress%2Cformat&w=1280&h=960&fit=max',

[I've attached the ]{}[fritzing](http://fritzing.org/)[schematic in fzz
format and a picture of it for easy visualization of the connections.]{}

1\. You need to solder 3 male pins on the back of the neopixel ring like
shown in the picture

- solder the positive pin

- solder the ground

- solder the data input pin

2\. Then the 4x battery holder should have a way of a connecting to the
breadboard, a easy solution is to solder two male dupont wires to it's
terminals.

3\. Prepare the breadboard.

- place the neopixel ring, microcontroller and gyroscope on the
breadboard like in the image

- place all the negative wires: to the microcontroller, neopixel ring,
gyro

- place all the positive wires: to the microcontroller, neopixel ring,
gyro

- place all the data wires:

\* SDA and SCL from the to the microcontroller to the gyro

\* pin D6 from the microcontroller to the neopixel ring

- double check all connections before powering

- optionally using duct tape, tape the battery pack on the back of the
bradboard to hold it in place and make it more portable

### [**](#toc-step-3--the-code-and-calibration-2){.title-anchor}[Step 3: The Code and Calibration]{} {#toc-step-3--the-code-and-calibration-2}

**First**[ you need to download and install two libraries:]{}

[1. ]{}[Adafruit neopixel
library](https://github.com/adafruit/Adafruit_NeoPixel)[fir controlling
the neopixel]{}

[2. ]{}[MPU6050 library
f](https://github.com/jrowberg/i2cdevlib/tree/master/Arduino/MPU6050)[or
the gyroscope]{}

They are two great libraries that will do the heavy lifting!

[More details on the neopixels
]{}[here](https://learn.adafruit.com/adafruit-neopixel-uberguide/the-magic-of-neopixels)

**Then**[ download and install my library from
]{}[here](https://github.com/danionescu0/arduino/tree/master/projects/neopixel_ring_gyroscope)[or
copy it from below:]{}

    #include "I2Cdev.h"
    #include <Adafruit_NeoPixel.h>
    #include "MPU6050_6Axis_MotionApps20.h"
    #include "Wire.h"
    #define NEOPIXED_CONTROL_PIN 6
    #define NUM_LEDS 24
    const int MAX_ANGLE = 45;
    const int LED_OFFSET = 12;
    MPU6050 mpu;
    Adafruit_NeoPixel strip = Adafruit_NeoPixel(NUM_LEDS, NEOPIXED_CONTROL_PIN, NEO_RBG + NEO_KHZ800);
    unsigned long lastPrintTime = 0;
    bool initialization = false;  // set true if DMP init was successful
    uint8_t mpuIntStatus;   // holds actual interrupt status byte from MPU
    uint8_t devStatus;      // return status after each device operation (0 = success, !0 = error)
    uint16_t packetSize;    // expected DMP packet size (default is 42 bytes)
    uint16_t fifoCount;     // count of all bytes currently in FIFO
    uint8_t fifoBuffer[64]; // FIFO storage buffer
    Quaternion q;           // [w, x, y, z]         quaternion container
    VectorFloat gravity;    // [x, y, z]            gravity vector
    float ypr[3];           // [yaw, pitch, roll]   yaw/pitch/roll container and gravity vector
    volatile bool mpuInterrupt = false;     // indicates whether MPU interrupt pin has gone high</p><p>void setup()
    {
       Serial.begin(9600);
       Serial.println("Program started");
       initialization = initializeGyroscope();
       strip.begin();
    }
    void loop()
    {
       if (!initialization) {
           return;
       }
       mpuInterrupt = false;
       mpuIntStatus = mpu.getIntStatus();
       fifoCount = mpu.getFIFOCount();
       if (hasFifoOverflown(mpuIntStatus, fifoCount)) {
           mpu.resetFIFO();
           return;
       }
       if (mpuIntStatus & 0x02) {
           while (fifoCount < packetSize) {
               fifoCount = mpu.getFIFOCount();
           }
           mpu.getFIFOBytes(fifoBuffer, packetSize);
           fifoCount -= packetSize;
           mpu.dmpGetQuaternion(&q, fifoBuffer);
           mpu.dmpGetGravity(&gravity, &q);
           mpu.dmpGetYawPitchRoll(ypr, &q, &gravity);
           redrawLeds(ypr[0] * 180/M_PI, ypr[1] * 180/M_PI, ypr[2] * 180/M_PI);
       }
    }
    boolean hasFifoOverflown(int mpuIntStatus, int fifoCount)
    {
       return mpuIntStatus & 0x10 || fifoCount == 1024;
    }
    void redrawLeds(int x, int y, int z)
    {
       x = constrain(x, -1 * MAX_ANGLE, MAX_ANGLE);
       y = constrain(y, -1 * MAX_ANGLE, MAX_ANGLE);
       if (y < 0 and z > 0) {
           lightLeds(y, z, 0, 5, 0, 89);
       } else if (y < 0 and z < 0) {
           lightLeds(y, z, 6, 12, 89, 0);
       } else if (y > 0 and z < 0) {
           lightLeds(y, z, 13, 19, 0, 89);
       } else if (y > 0 and z > 0) {
           lightLeds(y, z, 20, 24, 89, 0);
       }
    }
    void lightLeds(int x, int y, int fromLedPosition, int toLedPosition, int fromAngle, int toAngle)
    {
       double angle = (atan((double) abs(x) / (double) abs (y)) * 4068) / 71;
       int ledNr = map(angle, fromAngle, toAngle, fromLedPosition, toLedPosition);
       printDebug(x, y, ledNr, angle);
       uint32_t color;
       for (int i=0; i < NUM_LEDS; i++) {
           color = strip.Color(0, 0, 0);
           if (i == ledNr) {
              color = strip.Color(0, 180, 0);
           } else if (i == ledNr - 1) {
              color = strip.Color(0, 5, 0);
           }
           strip.setPixelColor(normalizeLedPosition(i), color);
           strip.show();
       }
    }
    int normalizeLedPosition(int position)
    {
       if (NUM_LEDS > position + LED_OFFSET) {
           return position + LED_OFFSET;
       }
       return position + LED_OFFSET - NUM_LEDS;
    }
    void printDebug(int y, int z, int lightLed, int angle)
    {
       if (millis() - lastPrintTime < 500) {
           return;
       }
       Serial.print("a=");Serial.print(angle);Serial.print("; ");
       Serial.print("ll=");Serial.print(lightLed);Serial.print("; ");
       Serial.print("y=");Serial.print(y);Serial.print("; ");
       Serial.print("z=");Serial.print(z);Serial.println("; ");
       lastPrintTime = millis();
    }
    bool initializeGyroscope() {
       Wire.begin();
       TWBR = 24;
       mpu.initialize();
       Serial.println(mpu.testConnection() ? F("MPU6050 connection successful") : F("MPU6050 connection failed"));
       Serial.println(F("Initializing DMP..."));
       devStatus = mpu.dmpInitialize();
       mpu.setXGyroOffset(220);
       mpu.setYGyroOffset(76);
       mpu.setZGyroOffset(-85);
       mpu.setZAccelOffset(1788);
       if (devStatus != 0) {
           Serial.print(F("DMP Initialization failed (code "));Serial.println(devStatus);
           return false;
       }
       mpu.setDMPEnabled(true);
       Serial.println(F("Enabling interrupt detection (Arduino external interrupt 0)..."));
       attachInterrupt(0, dmpDataReady, RISING);
       mpuIntStatus = mpu.getIntStatus();
       Serial.println(F("DMP ready! Waiting for first interrupt..."));
       packetSize = mpu.dmpGetFIFOPacketSize();
       return true;
    }
    void dmpDataReady()
    {
       mpuInterrupt = true;
    }

**Upload the code:**

Using the FTDI adapter upload the code to the arduino.

**Connect the power supply (batteries)**

**Calibration:**

The most important thing to calibrate here is "LED\_OFFSET" constant. In
my example is 12. You need to adjust this from 0 to 23 so that after
powering the board the led will light in the direction you tilt the
board.

*If you want to find out more details about how it works check out the
next step*

### [**](#toc-step-4--how-it-works--optional-3){.title-anchor}[Step 4: How It Works (optional)]{} {#toc-step-4--how-it-works--optional-3}

https://hackster.imgix.net/uploads/attachments/393486/2017-12-10_23_57_35_eY4K29OmqY.jpg?auto=compress%2Cformat&w=680&h=510&fit=max
URL: 'https://hackster.imgix.net/uploads/attachments/393486/2017-12-10_23_57_35_eY4K29OmqY.jpg?auto=compress%2Cformat&w=1280&h=960&fit=max',

**First**[ a little information about the MPU6050 gyroscope. This is a
MEMS gyroscope (MEMS stands for Microelectromechanical systems).]{}

Each type of MEMs gyroscope has some form of oscillating component from
where the acccleration, and hence direction change, can be detected.
This is because, as per the conservation of motion law, a vibrating
object likes to continue vibrating in the same plane, and any
vibrational deviation can be used to derive a change in direction.

The gyro also contains a microcontroller of it's own to compute the
roll, pitch and yaw through some fancy maths.

But the gyro raw data suffers from noise and drift, so we used an
external library to smooth things out and give us clean usable data.

**The Neopixel**[ are RGB leds individually addressable and chained into
bands and rings. They work on 5V and they contain they own circuitry so
you only need to power the neopixels and to communicate with them using
the data line. The communication is done with a single data line
containing clock and data (more details
]{}[here)](https://learn.adafruit.com/adafruit-neopixel-uberguide/advanced-coding)[.
Adafruit provides a clean library for interacting with the neopixel
rings.]{}

**The code**

[Inside the l]{}*oop()*[ function the MPU6050\_6Axis\_MotionApps20
library is called. When the library has new data from the gyroscpe it
calls ]{}*redrawLeds(x, y, z)*[ with 3 arguments representing yaw, pitch
and roll]{}

[Inside ]{}*redrawLeds*[():]{}

- we're focusing on two axis : y, z

- we're constraining both axys from -MAX\_ANGLE to +MAX\_ANGLE, we
defined max angle to 45 and it's changable

- we're splitting 360 degreeds into 4 quadrants and call lightLeds()
functions for each as follows:

\* y negative, z positive first quadrant will control led's from 0 to 5,
the angle will be from 0 to 89

\* y negative, z negative second quadrant controls led's from 6 to 12,
the angle will be from 89 to 0

\* ...etc

[- inside the ]{}*lightLeds*[ function]{}

\* i'm calculating an angle based on the two axis using arctangent
(check the attached picture)

\* i'm calculating what led to show using the arduino map function

\* i'm resetting the led strip all but two led's, the one corresponding
to the led position i've calculated before and a led position before (to
show a fade effect)

[\* i'm using a function called ]{}*normalizeLedPosition()*[ to take
into account the neopixel calibration. The calibration is useful because
the neopixel ring can be rotated as pleased, and should be aligned with
the gyroscope]{}

\* i'm also printing the tow axis, what led has light and the angle

**The math**

I've attached a picture with the led ring and the trigonometric function
used to determine the angle.

##### sketch\_gMlSrk3rCX.fzz
https://halckemy.s3.amazonaws.com/uploads/attachments/393490/sketch_gMlSrk3rCX.fzz
}
